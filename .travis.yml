dist: trusty
language: rust
services: docker
sudo: required
env:
  global:
  - CRATE_NAME=thumbcloud
  - secure: ilDfk3OerK7C2PGU5tGlgWVwfoB+iLJigfeqvpkzWfXJ4RY4ZSeixC7qTCgU4rNYsIDYkJhW9LG2NbdKDP/MZ8J+przGRuUzrMMX8NAm8SnLAWhWnsdjqwLOMHAXzDzm1MMsqngDZU3ZfJN3HToy2jj2CDdCReQC7rsCvRbZmzhP7QhZ2aAAo0MXaxlKAofxq1T8Hkhoy52L/ucX8/fBWdAdhNxrbw5AC6x501i8HPUoK/Rsi/tJOfxOP3usj3X2s/yYljYgwhAEs4MsK32D1kEmMXc15h+fF/9KswgUN6ovRAx1ZtOoQJVM5SrBl8Uwz4ZqKTw5bGMnTMQb3ExH6s8P2YxFodNH1f0V5nf5y1FKHdff1hwCO/gTaBnfMXo3zM3m51LOdQYYU2IUFnSo/biCeXhXgrYBQMvXYG4GfwEZsimEhXCt9GZ6z4/ptWddhZv1o5WN24Kkrs3YRpcxSdOanSu/7ojj0A1SkmHglbZMiR2sLdNLEwcc4UU4qVp+4l3QJ0KIrLzkkw4F9xzGKdwqkS5q68e5Whb7RMslBowqcXlYnfjnCrfDDNTjv/qf6fGlinm64WvONHL8ifNJM0z2bMWUopaU7/jDrVJs2eYaQwrv1CFzMHUJQhEpVypyVCiCAcp68+DNGBWyaG3Jy5yLGYI1c/LgJ3iabv7KfWA=
matrix:
  include:
  - env: TARGET=aarch64-unknown-linux-gnu
  - env: TARGET=arm-unknown-linux-gnueabi
  - env: TARGET=armv7-unknown-linux-gnueabihf
  - env: TARGET=i686-unknown-linux-gnu
  - env: TARGET=x86_64-unknown-linux-gnu
  - env: TARGET=x86_64-apple-darwin
    os: osx
  - env: TARGET=i686-unknown-freebsd DISABLE_TESTS=1
  - env: TARGET=x86_64-unknown-freebsd DISABLE_TESTS=1
before_install:
- set -e
- rustup self update
install:
- sh ci/install.sh
- source ~/.cargo/env || true
script:
- bash ci/script.sh
after_script: set +e
before_deploy:
- sh ci/before_deploy.sh
deploy:
  api_key:
    secure: Obc2dRPPqUP8NGeWfJyVacnq8wfNplFliR1RepBqSRp9FsqVigaMqfdWUxrCXNDsjlAKXFM1u5xgAxtuhlcLTqC+FbONG7W0bj0s4bKCDpRrJUB1e86MQ09Mtj5VHUPjkxqCd9dogq54jYiBfznRINz2C1QWYkwCGhhETxTD6i5VWPPartWS8zdiSPPbLm4uTtzpGQUPXeElenzT9IrJKQ9bJE0xtIv1ndjGMYkinLP/YDEAQ2YOfh3v0vLtZXlbD/GhM/TNEEviqExsqyACxNCEVfWn2zpiIefj7RH/gMVtiUWcMcBzS+yTXkEe9KGp7sKpICuvW5EttqO6k49bnICP5P7BFBuy58J0UYr5lA9cP994E+x/0dC6KIK54c745zhOeS0m0fCEjKau/lv0PjbySDpNET5gANdbLo+uXGyK4KwZTxzPQXXsr29aCo++4j9w6rr4CunolIzyS9XQzgbn52AncmUV5R4bREVso18OAtJTXQhtaVGK1iyfrmtiA7jgrIw5bYd4zC2rzqLRXPB5T8Bs86bEjOVVHZvxQ0GK6Tm6OoGF0p1WcGNJiEPG2zt/K+nLYZQ2+KNIHrNsuOBEA5lapQK6l+FXHkTriZWeYvaFlq0H4ZiexgaqI9TLgl0FbSiut0wCeP0Jo7bx5E05/NFyutX5sbnw7Hebkg4=
  file_glob: true
  file: "$CRATE_NAME-$TRAVIS_TAG-$TARGET.*"
  on:
    condition: "$TRAVIS_RUST_VERSION = stable"
    tags: true
  provider: releases
  skip_cleanup: true
cache: cargo
before_cache:
- chmod -R a+r $HOME/.cargo
branches:
  only:
  - "/^v\\d+\\.\\d+\\.\\d+.*$/"
  - master
notifications:
  email:
    on_success: never
